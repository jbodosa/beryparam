* GENERATED BY SYSGEN
* THIS IS TO WRITE THE CHARMM INP FOR ADDING ION 
* Made by jbodosa on 2025-01-04 21:01
* 

DIMENS CHSIZE 5000000 MAXRES 3000000

! Load topology and parameter files
stream toppar.str

! Read in the PSF and coordinate files
open read card unit 10 name recenter.psf
read psf card unit 10
close unit 10

open read card unit 20 name recenter.crd
read coor card unit 20
close unit 20

! Print current coordinates for verification
coor stat

! Define a reference point (e.g., center of a residue or atom ID)
define reference sele resid 1 .and. type P1 end

! Calculate the coordinates of the reference point
coor stat sele reference end
set refx = ?XAVE
set refy = ?YAVE
set refz = ?ZAVE

! Add the ion
! Define the position 20 Ã… (2 nm) away from the reference point along the x-axis
calc ionx = @refx + 20.0
calc iony = @refy
calc ionz = @refz

! Create a new segment for the ion
read sequence POT 1
generate POT setup

! Assign the ion type (e.g., NA+ for sodium ion)
coor set xdir @ionx ydir @iony zdir @ionz sele segid POT end
ic fill preserve
ic param
ic build

! Add ion parameters to the system
stream toppar.str

! Print new coordinates for verification
coor stat

! Write the updated PSF and coordinate files
open write card unit 30 name updated_system.psf
write psf card unit 30
close unit 30

open write card unit 40 name updated_system.crd
write coor card unit 40
close unit 40

stop
