* GENERATED BY SYSGEN
* THIS IS TO GENRATE A WATERBOX OF GIVEN SIZE
* Made by jbodosa on 2025-01-04 21:01
* 

DIMENS CHSIZE 5000000 MAXRES 3000000
! Read topology and parameter files
stream toppar.str
! read the sequence
read sequence DMP 1
generate DMP

! Read the coordinates of the non-charged molecule
open read card unit 31 name recenter.crd
read coor card unit 31 
close unit 31
! Read water box parameters and coordinates
stream waterbox.str
open read card unit 30 name waterbox.crd
read coor card unit 30 append
close unit 30
! Remove water molecules overlapping with the non-charged molecule
define NONCHG sele .not. hydrogen .and. (  segid DMP  ) end
if ?nsel .gt. 0 then
    define target sele .byres. ( ( type OH2 .and. segid SOLV ) .and. ( NONCHG .around. 2.8 ) ) end
    if ?nsel .gt. 0 delete atom sele target end
endif
! Check and count the remaining water molecules
coor stat sele type OH2 .and. segid SOLV end
set nwater ?nsel
! Write coordinates and system information
open write unit 10 card name solvated_sys.psf
write psf unit 10 card
open write card unit 10 name solvated_sys.pdb
write coor pdb unit 10
open write unit 10 card name solvated_sys.crd
write coor unit 10 card
open write unit 90 card name solvated_sys.str
write title unit 90
** Solvated system settings
**
* read sequence TIP3 @nwater
* generate SOLV setup noangle nodihedral
*
stop
