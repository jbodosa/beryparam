* GENERATED BY CHARMM-GUI (http://www.charmm-gui.org) VERSION on Mar, 05. 2015.
* ASSEMBLE PREVIOUSLY GENERATED COMPONENTS (LIPID BILAYER, PROTEIN, PORE WATER, WATER, AND ION)
* 

bomlev -3
 
DIMENS CHSIZE 2000000
!DIMENS CHSIZE 1000000

! Read topology and parameter files
stream toppar.str

!Read the system information
stream step3_size.str

! Read the CAL
read sequence CAL 1
generate CAL


! Read the CLA
read sequence CLA 2
generate CLA noang nodihed

open read unit 10 card name cal_cla.pdb 
read coor pdb unit 10 resid

define solute sele segid CAL .or. segid CLA end
cons harm absolute force 1.0 sele solute end

define PTOT sele .not. hydrogen end

!
!Add water? 
!
open read card unit 10 name waterbox_6nm.crd
read sequence coor card unit 10
generate W1 setup warn noangle nodihedral

open read unit 10 card name waterbox_6nm.crd
read coor unit 10 card append

coor stat sele segid W1 end

define junk sele .byres. ( ( segid W1 .and. type OH2 ) .and. -
                           ( PTOT .around. 2.8 ) ) end
if ?nsel .ne. 0 delete atom sele junk end

if nwater .ne. 0 then
   join TIP3 W1 renumber
else
   rename segid TIP3 sele segid W1 end
   join TIP3 renumber
endif

join TIP3 W3 renumber
!
! Write PSF, coordinates, and information of the assembled system
!

open write unit 10 card name cal_cla_wat.crd
write coor unit 10 card


open write unit 10 card name cal_cla_wat.pdb
write coor pdb unit 10 


open write unit 10 card name cal_cla_wat.psf
write  psf card unit 10 


stop
